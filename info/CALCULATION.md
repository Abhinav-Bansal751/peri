# Описание вычислений

У нас есть два основных понятия, которые лежат в основе вычислений: длина цикла и длина месячных.

Длина месячных - дни выделения крови из матки у женщины.
Длина цикла - количество дней от первого дня текущих месячных до первого дня следующих. Месячные являются частью цикла. С них начинается цикл.
Длина месячных обычно составляет 3-7 дней, длина цикла 21-35 дней. Отметим, что каждый новый цикл эти значения могут меняться.

Далее опишем основные расчеты, которые необходимы для работы приложения:

## Вычисление предполагаемой даты начала следующих месячных

Допустим, мы знаем дату начала текущих месячных, среднее значение длины цикла. Тогда, чтобы узнать дату начала следующих месячных нужно:

```ts
function getNextPeriod(startDate: Date, cycleLength: number){
    return startDate.addDays(cycleLength);
}
```

Значение предполагаемое, потому что длина каждого нового цикла может отличаться и это нормально. Длина месячных также может отличаться, поэтому длина следующих месячных вычисляется как среднее значение предыдущих.

## Текущий день цикла

Текущий день цикла важен для дальнейших вычислений. В зависимости от того, какой сейчас день цикла, в организме происходят изменения, о которых будет написано ниже. Поэтому для начали опишем как он вычисляется:

```ts
function getCurrentDay(startDate: Date, cycleLength: number){
    const today = new Date();
    return today.getDays() - startDate.getDays();
}
```

## День овуляции

Для начала стоит отметить, что вычисление овуляции никогда не дает точный результат. Точно узнать, когда произошла овуляция, можно только с помощью специальных медицинских тестов. Но у многих день овуляции все-таки совпадает с вычислениями.

### Немного о том, что такое овуляция

Овуляция - это выход зрелой яйцеклетки из фолликула яичника в брюшную полость. Яйцеклетка ждет своего оплодотворения 12-48 часов. Дальше оплодотворение невозможно. Таким образом только в овуляцию девушка может забеременеть.

Но определение дней овуляции расчетами носит только примерный характер, который берет средние значения. На деле все намного сложнее: овуляция может быть ранней или поздней, ее может быть две, а может не быть и вовсе и тд. Без специальных медицинских тестов, точно рассчитывать на вычисленные значения нельзя.

### Как рассчитать день овуляции

Мы знаем значение длины цикла и дату начала текущего цикла. Для примера пусть длина цикла будет 30 дней. В большинстве случаев овуляция происходит за 14 дней до начала месячных, то есть за 14 дней до начала нового цикла. Следовательно, если длина цикла 30 дней, тогда овуляция произойдет на ```30-14=16``` день цикла.

Конкретный пример с датами:
Пусть месячные (а следовательно и цикл) начались 1 января, средняя длина месячных 25 дней. Тогда овуляция произойдет на 11 дней цикла, то есть 11 января.

Таким образом, функция будет выглядеть следующим образом:

```ts
function getOvulationStatus(startDate: Date, cycleLength: number){
    const currentDay = getCurrentDay(startDate, cycleLength);
    const diff = cycleLength - currentDay;

    if (diff > 14){
        return `Ovulation in ${diff - 14} Days`;
    }
    if (diff === 14){
        return "Ovulation today";
    }
    return "Ovulation finished";
}
```

Немного усовершенствуем функцию. Так как яйцеклетка может существовать 12-48 часов, следовательно овуляция может длиться дольше на 2 дня. Тогда функция будет выглядеть следующим образом:

```ts
function getOvulationStatus(startDate: Date, cycleLength: number){
    const currentDay = getCurrentDay(startDate, cycleLength);
    const diff = cycleLength - currentDay;

    if (diff > 14){
        return `Ovulation in ${diff - 14} Days`;
    }
    if (diff === 14){
        return "Ovulation today";
    }
    if (diff >= 12){
        "Ovulation possible"
    }
    return "Ovulation finished";
}
```

## Шанс забеременеть

Как написано выше, беременность происходит только в овуляцию. Тогда получается, что в дни овуляции высокий шанс забеременеть. Тогда функция будет выглядеть так:

```ts
function getPregnancyChance(startDate: Date, cycleLength: number){
    const currentDay = getCurrentDay(startDate, cycleLength);
    const diff = cycleLength - currentDay;

    if (diff === 14){
        return "High";
    }
    return "Low";
}
```

Но, как описано в предыдущем разделе, овуляция может происходить не только в день расчетов. Поэтому добавим равную в 2 дня погрешность:

```ts
function getPregnancyChance(startDate: Date, cycleLength: number){
    const error = 2;
    const currentDay = getCurrentDay(startDate, cycleLength);
    const diff = cycleLength - currentDay;

    if (diff >= 14 - error && diff <= 14 + error){
        return "High";
    }
    return "Low";
}
```

## Количество дней до месячных

Чтобы узнать сколько дней осталось до месячных, нам необходимо два вводных значения: средняя длина цикла ```lengthCycle``` и дата начала текущего цикла ```startDate```. Тогда расчеты будут выглядеть так:

```ts
function getDaysBeforePeriod(startDate: Date, cycleLength: number){
    const currentDay = getCurrentDay(startDate, cycleLength);
    const diff = cyclesLength - currentDay;
    if (diff === 0){
        return "Period is today";
    }
    return `Period in ${diff} Days`;
}
```

Может возникнуть ситуация, когда предполагаемый день месячный прошел, а месячные так и не наступили. В этом случае введем понятие "задержка". Учитывать ее также нужно. Задержка до 8-10 дней считается нормой, больше может говорить о некоторых проблем со здоровьем, беременностью или других факторов.

После этого функция будет выглядеть так:

```ts
function getDaysBeforePeriod(startDate: Date, cycleLength: number){
    const currentDay = getCurrentDay(startDate, cycleLength);
    const diff = cyclesLength - currentDay;
    if (diff > 0){
        return `Period in ${diff} Days`;
    }
    if (diff === 0){
        return "Period is today";
    }
    return `Period in ${Math.abs(diff)} Days`;
}
```

## Фазы цикла

### Теоретическая информация

Весь менструальный цикл можно разделить на 2 фазы: фолликулярную и лютеиновую. Фолликулярна фаза начинается с первого дня месячных и продолжается до овуляции. Лютеиновая фаза начинается после овуляции и заканчивается месячными. В течение этих фаз главные гормоны постоянно перестраиваются, что сказывается на самочувствие. Ниже на картинке представлен график 28-дневного цикла. На нем показано, как меняются гормоны в каждую фазу.

<img src="https://qpicture.ru/images/2022/12/27/crc.jpg">

Как видно на графике, дни месячных входят в фолликулярную фазу. Однако, для более точного описание состояния организма, я выделила 4 фазы:

- Менструальная фаза
- Фолликулярная фаза
- Овуляция
- Лютеиновая фаза.

Для каждой фазы из-за перестройки гормонов свойственны характерные симптомы. Наиболее частый и показательный из них - это либидо (перед и во время овуляции оно возрастает), ПМС (характерен для лютеиновой фазы) и др.

### Расчет текущей фазы

Для расчетов нам необходимы три вводных значения: длина цикла ```lengthCycle```, длина месячных ```lengthPeriod``` и дата начала цикла ```startDate```. Как описано выше, деление фаз зависит от овуляции, значит ее расчеты также необходимы. Функция будет выглядеть следующим образом:

```ts
function getPhase(cycleLength: number, periodLength: number, startDate: Date){
    const currentDay = getCurrentDay(startDate, cycleLength);
    const ovulationStatus = getOvulationStatus(startDate, cycleLength);
    
    if (currentDay <= periodLength){
        return "Menstrual phase";
    }
    if (ovulationStatus === "Ovulation today" && ovulationStatus === "Ovulation possible"){
        return "Ovulation phase";
    }
    if (ovulationStatus === "Ovulation finished"){
        return "Luteal phase";
    }
    return "Follicular phase";
}
```
